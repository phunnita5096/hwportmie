<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>Medieval Book â€¢ three.js</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- âœ… à¹‚à¸«à¸¥à¸” Three.js à¹à¸¥à¸°à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¹€à¸ªà¸£à¸´à¸¡ -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/EXRLoader.js"></script>

  <!-- à¸Ÿà¸­à¸™à¸•à¹Œà¸™à¹ˆà¸²à¸£à¸±à¸ -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    html,body{height:100%;margin:0;overflow:hidden;}
    canvas{display:block;}
    #loadingScreen {
      position: fixed;
      inset: 0;
      background-color: #ffe6f2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      font-family: 'Press Start 2P', cursive;
      color: #ff69b4;
      text-align: center;
      opacity: 1;
      transition: opacity 9s ease;
    }
    #heartBar {
      width: 200px; height: 20px;
      border: 2px solid #ff69b4;
      border-radius: 10px;
      background-color: #ffd6e8;
      overflow: hidden;
    }
    #progress {
      width: 0%;
      height: 100%;
      background-color: #ff69b4;
      border-radius: 10px;
      transition: width 10s ease;
    }
  </style>
</head>
<body>
  <!-- ðŸ’– Cute Loading Screen -->
  <div id="loadingScreen">
    <div style="font-size: 24px; margin-bottom: 20px;">LOADING...</div>
    <div id="heartBar"><div id="progress"></div></div>
    <div style="margin-top: 10px; font-size: 12px;">ðŸ’– Please wait ðŸ’–</div>
  </div>

  <script>
  // ðŸŒ¸ à¸ªà¸£à¹‰à¸²à¸‡ scene à¸«à¸¥à¸±à¸
  const scene = new THREE.Scene();

  // âœ… à¹‚à¸«à¸¥à¸” EXR environment background
  const exrLoader = new THREE.EXRLoader();
  exrLoader.load('industrial_sunset_02_puresky_1k.exr', (texture) => {
    texture.mapping = THREE.EquirectangularReflectionMapping;
    texture.colorSpace = THREE.SRGBColorSpace;
    scene.background = texture;
    scene.environment = texture;
  });

  // ðŸ“¸ à¸à¸¥à¹‰à¸­à¸‡
  const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 200);
  camera.position.set(-25, 25, 35);  // à¸¡à¸¸à¸¡à¹€à¸‰à¸µà¸¢à¸‡à¸‹à¹‰à¸²à¸¢à¸šà¸™
  camera.lookAt(10, 6, 0);

  // ðŸª„ Renderer
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.outputEncoding = THREE.sRGBEncoding;
  renderer.shadowMap.enabled = true;
  document.body.appendChild(renderer.domElement);

  // ðŸŽ® Controls
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enabled = false; // à¸›à¸´à¸”à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ intro
  controls.target.set(10, 8, 0);
  controls.update();

  // ðŸ’¡ à¹à¸ªà¸‡
  const hemi = new THREE.HemisphereLight(0xffffff, 0x333333, 0.6);
  scene.add(hemi);

  const dir = new THREE.DirectionalLight(0xffffff, 1.0);
  dir.position.set(3, 5, 2);
  dir.castShadow = true;
  scene.add(dir);

  // ðŸ’– Loading Manager
  const manager = new THREE.LoadingManager();
  manager.onProgress = (url, loaded, total) => {
    const percent = Math.round((loaded / total) * 100);
    document.getElementById("progress").style.width = percent + "%";
  };
  manager.onLoad = () => {
    const loadingScreen = document.getElementById("loadingScreen");
    setTimeout(() => {
      loadingScreen.style.opacity = "0";
      setTimeout(() => loadingScreen.remove(), 3000);
      startIntroCameraMove();
    }, 1000);
  };

  // ðŸ“¦ à¹‚à¸«à¸¥à¸”à¹‚à¸¡à¹€à¸”à¸¥ GLTF
  const loader = new THREE.GLTFLoader(manager);
  const clock = new THREE.Clock();
  let mixer = null;

  loader.load(
    'scene.gltf',
    (gltf) => {
      const model = gltf.scene;
      model.traverse((node) => {
        if (node.isMesh) {
          node.castShadow = true;
          node.receiveShadow = true;
        }
      });
      if (gltf.animations.length) {
        mixer = new THREE.AnimationMixer(model);
        gltf.animations.forEach((clip) => mixer.clipAction(clip).play());
      }
      model.position.set(0, 0, 0);
      scene.add(model);
    },
    undefined,
    (error) => console.error('âŒ Error loading glTF:', error)
  );

  // ðŸŽ¥ à¸à¸¥à¹‰à¸­à¸‡à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸‹à¸¹à¸¡à¹€à¸‚à¹‰à¸²
  let camStart = new THREE.Vector3(-35, 30, 50);
  let camEnd = new THREE.Vector3(-25, 25, 35);
  let introProgress = 0;
  let introActive = false;

  function startIntroCameraMove() {
    introProgress = 0;
    introActive = true;
  }

  window.addEventListener('resize', () => {
    camera.aspect = innerWidth / innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });

  function animate() {
    requestAnimationFrame(animate);
    const delta = clock.getDelta();
    if (mixer) mixer.update(delta);

    if (introActive) {
      introProgress += delta * 0.4;
      if (introProgress >= 1) {
        introProgress = 1;
        introActive = false;
        controls.enabled = true;
      }
      camera.position.lerpVectors(camStart, camEnd, introProgress);
      camera.lookAt(10, 8, 0);
    }

    renderer.render(scene, camera);
  }
  animate();
  </script>
  <script>
/* ðŸŽ¯ à¹€à¸žà¸´à¹ˆà¸¡à¸£à¸°à¸šà¸šà¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸•à¸–à¸¸ + à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸µ + à¸à¸¥à¹‰à¸­à¸‡à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™ */

const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
let selectedObject = null;

// ðŸ“ à¸ˆà¸¸à¸”à¸à¸¥à¹‰à¸­à¸‡à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¹à¸•à¹ˆà¸¥à¸°à¸›à¸¸à¹ˆà¸¡ (à¹ƒà¸ªà¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸ˆà¸£à¸´à¸‡à¸•à¸²à¸¡à¸‰à¸²à¸à¸„à¸¸à¸“)
const cameraTargets = {
  "About me": new THREE.Vector3(5, 10, 15),
  "Project": new THREE.Vector3(-5, 12, 20),
  "Credit": new THREE.Vector3(0, 8, 25)
};

// ðŸŽ¨ à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸µ
function setHighlight(obj, highlight) {
  if (!obj.material) return;
  if (highlight) {
    obj.material.color.set(0xffe699); // à¸ªà¸µà¹€à¸«à¸¥à¸·à¸­à¸‡à¸žà¸²à¸ªà¹€à¸—à¸¥
  } else {
    obj.material.color.set(0xffffff); // à¸ªà¸µà¹€à¸”à¸´à¸¡ (à¸‚à¸²à¸§)
  }
}

// ðŸŽ¯ à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¹€à¸¡à¸²à¸ªà¹Œà¸Šà¸µà¹‰
window.addEventListener('mousemove', (event) => {
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);

  const intersects = raycaster.intersectObjects(scene.children, true);
  if (intersects.length > 0) {
    const obj = intersects[0].object;

    if (selectedObject !== obj) {
      if (selectedObject) setHighlight(selectedObject, false);
      selectedObject = obj;
      setHighlight(selectedObject, true);
    }
  } else {
    if (selectedObject) setHighlight(selectedObject, false);
    selectedObject = null;
  }
});

// ðŸ‘† à¸„à¸¥à¸´à¸à¹à¸¥à¹‰à¸§à¸à¸¥à¹‰à¸­à¸‡à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™
window.addEventListener('click', () => {
  if (!selectedObject || !selectedObject.name) return;

  const name = selectedObject.name.toLowerCase();
  for (let key in cameraTargets) {
    if (name.includes(key.toLowerCase())) {
      moveCameraTo(cameraTargets[key]);
    }
  }
});

// ðŸŽ¥ à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸à¸¥à¹‰à¸­à¸‡
function moveCameraTo(targetPos) {
  const startPos = camera.position.clone();
  const endPos = targetPos.clone();
  let progress = 0;

  const move = () => {
    progress += 0.02;
    camera.position.lerpVectors(startPos, endPos, progress);
    camera.lookAt(0, 5, 0);
    if (progress < 1) requestAnimationFrame(move);
  };
  move();
}
</script>

</body>
</html>
