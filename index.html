<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>Medieval Book • three.js</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ✅ โหลด Three.js และเครื่องมือเสริม -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/EXRLoader.js"></script>

  <!-- ฟอนต์น่ารัก -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    html,body{height:100%;margin:0;overflow:hidden;}
    canvas{display:block;}
    #loadingScreen {
      position: fixed;
      inset: 0;
      background-color: #ffe6f2;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      font-family: 'Press Start 2P', cursive;
      color: #ff69b4;
      text-align: center;
      opacity: 1;
      transition: opacity 9s ease;
    }
    #heartBar {
      width: 200px; height: 20px;
      border: 2px solid #ff69b4;
      border-radius: 10px;
      background-color: #ffd6e8;
      overflow: hidden;
    }
    #progress {
      width: 0%;
      height: 100%;
      background-color: #ff69b4;
      border-radius: 10px;
      transition: width 10s ease;
    }
  </style>
</head>
<body>
  <!-- 💖 Cute Loading Screen -->
  <div id="loadingScreen">
    <div style="font-size: 24px; margin-bottom: 20px;">LOADING...</div>
    <div id="heartBar"><div id="progress"></div></div>
    <div style="margin-top: 10px; font-size: 12px;">💖 Please wait 💖</div>
  </div>

  <script>
  // 🌸 สร้าง scene หลัก
  const scene = new THREE.Scene();

  // ✅ โหลด EXR environment background
  const exrLoader = new THREE.EXRLoader();
  exrLoader.load('industrial_sunset_02_puresky_1k.exr', (texture) => {
    texture.mapping = THREE.EquirectangularReflectionMapping;
    texture.colorSpace = THREE.SRGBColorSpace;
    scene.background = texture;
    scene.environment = texture;
  });

  // 📸 กล้อง
  const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 200);
  camera.position.set(-25, 25, 35);  // มุมเฉียงซ้ายบน
  camera.lookAt(10, 6, 0);

  // 🪄 Renderer
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.outputEncoding = THREE.sRGBEncoding;
  renderer.shadowMap.enabled = true;
  document.body.appendChild(renderer.domElement);

  // 🎮 Controls
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enabled = false; // ปิดชั่วคราวระหว่าง intro
  controls.target.set(10, 8, 0);
  controls.update();

  // 💡 แสง
  const hemi = new THREE.HemisphereLight(0xffffff, 0x333333, 0.6);
  scene.add(hemi);

  const dir = new THREE.DirectionalLight(0xffffff, 1.0);
  dir.position.set(3, 5, 2);
  dir.castShadow = true;
  scene.add(dir);

  // 💖 Loading Manager
  const manager = new THREE.LoadingManager();
  manager.onProgress = (url, loaded, total) => {
    const percent = Math.round((loaded / total) * 100);
    document.getElementById("progress").style.width = percent + "%";
  };
  manager.onLoad = () => {
    const loadingScreen = document.getElementById("loadingScreen");
    setTimeout(() => {
      loadingScreen.style.opacity = "0";
      setTimeout(() => loadingScreen.remove(), 3000);
      startIntroCameraMove();
    }, 1000);
  };

  // 📦 โหลดโมเดล GLTF
  const loader = new THREE.GLTFLoader(manager);
  const clock = new THREE.Clock();
  let mixer = null;

  loader.load(
    'scene.gltf',
    (gltf) => {
      const model = gltf.scene;
      model.traverse((node) => {
        if (node.isMesh) {
          node.castShadow = true;
          node.receiveShadow = true;
        }
      });
      if (gltf.animations.length) {
        mixer = new THREE.AnimationMixer(model);
        gltf.animations.forEach((clip) => mixer.clipAction(clip).play());
      }
      model.position.set(0, 0, 0);
      scene.add(model);
    },
    undefined,
    (error) => console.error('❌ Error loading glTF:', error)
  );

  // 🎥 กล้องเคลื่อนซูมเข้า
  let camStart = new THREE.Vector3(-35, 30, 50);
  let camEnd = new THREE.Vector3(-25, 25, 35);
  let introProgress = 0;
  let introActive = false;

  function startIntroCameraMove() {
    introProgress = 0;
    introActive = true;
  }

  window.addEventListener('resize', () => {
    camera.aspect = innerWidth / innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });

  function animate() {
    requestAnimationFrame(animate);
    const delta = clock.getDelta();
    if (mixer) mixer.update(delta);

    if (introActive) {
      introProgress += delta * 0.4;
      if (introProgress >= 1) {
        introProgress = 1;
        introActive = false;
        controls.enabled = true;
      }
      camera.position.lerpVectors(camStart, camEnd, introProgress);
      camera.lookAt(10, 8, 0);
    }

    renderer.render(scene, camera);
  }
  animate();
  </script>
  <script>
/* 🎯 เพิ่มระบบเลือกวัตถุ + เปลี่ยนสี + กล้องเคลื่อน */

const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();
let selectedObject = null;

// 📍 จุดกล้องเป้าหมายแต่ละปุ่ม (ใส่ตำแหน่งจริงตามฉากคุณ)
const cameraTargets = {
  "About me": new THREE.Vector3(5, 10, 15),
  "Project": new THREE.Vector3(-5, 12, 20),
  "Credit": new THREE.Vector3(0, 8, 25)
};

// 🎨 ฟังก์ชันเปลี่ยนสี
function setHighlight(obj, highlight) {
  if (!obj.material) return;
  if (highlight) {
    obj.material.color.set(0xffe699); // สีเหลืองพาสเทล
  } else {
    obj.material.color.set(0xffffff); // สีเดิม (ขาว)
  }
}

// 🎯 ตรวจจับเมาส์ชี้
window.addEventListener('mousemove', (event) => {
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);

  const intersects = raycaster.intersectObjects(scene.children, true);
  if (intersects.length > 0) {
    const obj = intersects[0].object;

    if (selectedObject !== obj) {
      if (selectedObject) setHighlight(selectedObject, false);
      selectedObject = obj;
      setHighlight(selectedObject, true);
    }
  } else {
    if (selectedObject) setHighlight(selectedObject, false);
    selectedObject = null;
  }
});

// 👆 คลิกแล้วกล้องเคลื่อน
window.addEventListener('click', () => {
  if (!selectedObject || !selectedObject.name) return;

  const name = selectedObject.name.toLowerCase();
  for (let key in cameraTargets) {
    if (name.includes(key.toLowerCase())) {
      moveCameraTo(cameraTargets[key]);
    }
  }
});

// 🎥 ฟังก์ชันเคลื่อนกล้อง
function moveCameraTo(targetPos) {
  const startPos = camera.position.clone();
  const endPos = targetPos.clone();
  let progress = 0;

  const move = () => {
    progress += 0.02;
    camera.position.lerpVectors(startPos, endPos, progress);
    camera.lookAt(0, 5, 0);
    if (progress < 1) requestAnimationFrame(move);
  };
  move();
}
</script>

</body>
</html>
